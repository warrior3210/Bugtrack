# Project by Ananay Rampal
import MySQL.connector


from tabulate import tabulate

db = MySQL. connector. connect(
    host="localhost",
    user="root",
    password="password",
    database="bug_track"
)

cursor = db.cursor()



def login():
    while True:
        print("1. EMPLOYEE LOGIN")
        print("2. CUSTOMER ")
        print("3. Exit")

        choice = int(input("Enter your option: "))
        
            if choice == 1:
                print("\n----WELCOME TO LOGIN BLOCK----\n")
                login_id = input("Enter your login ID: ")
                password = input("Enter your password: ")

                 query = "SELECT * FROM employee WHERE empLoginId = %s AND empPassword = %s"
                cursor.execute(query, (login_id, password))
                result = cursor.fetchone()

                if result:
                    emp_type = result[2]  # Get the employee type (Admin or Expert)
                   if emp_type == "ADMIN":
                    admin_module()
                elif emp_type == "EXPERT":
                    expert_module()
            if choice == 2:
                    customer_module()

            if choice == 3:
                 break
        


def admin_module():
    while True:
        
            print("\n-----WELCOME TO THE ADMIN MODULE-----\n ")
            print("1. Customer Services")
            print("2. Employee Services")
            print("3. Bug Services")
            print("4. Logout")

            choice = int(input("Enter your choice: "))

            if choice == 1:
                customer_services()
            elif choice == 2:
                employee_services()
            elif choice == 3:
                bug_services()
            elif choice == 4:
                break
            else:
                print("\n---Invalid choice!--- ")
        




def customer_services():
    while True:
        
            print("\n-----WELCOME TO THE CUSTOMER SERVICES.-----\n")
            print("1. View All Customers")
            print("2. Search Customers by Name")
            print("3. Search Customers by Login ID")
            print("4. Go Back")

            choice = int(input("Enter your choice: "))


            if choice == 1:
                query = "SELECT * FROM customer"
                cursor.execute(query)
                results = cursor.fetchall()

                if results:
                    table = tabulate(results, headers=["ID", "Name", "Login ID", "Age", "Phone", "Email"],
                                     tablefmt="pretty")
                    print(table)

                else:
                    print("NO CUSTOMERS FOUND ")
            elif choice == 2:
                name = input("Enter the customer name: ")
                query = "SELECT * FROM customer WHERE custName LIKE %s"
                cursor.execute(query, ('%' + name + '%',))
                results = cursor.fetchall()

                if results:
                    table = tabulate(results, headers=["LoginId", "Password", "Name", "Age", "Phone", "Email"],
                                     tablefmt="pretty")
                    print(table)

                else:
                    print("\nNO CUSTOMERS FOUND WITH THE NAME:", name )


            elif choice == 3:
                login_id = input("Enter the customer login ID: ")
                query = "SELECT * FROM customer WHERE custLoginId = %s"
                cursor.execute(query, (login_id,))
                result = cursor.fetchall()

                if result:
                    table = tabulate(result, headers=["LoginId", "Password", "Name", "Age", "Phone", "Email"],
                                     tablefmt="pretty")
                    print(table)

                else:
                    print("\nNO CUSTOMER FOUND WITH THIS LOGIN ID:", login_id )

            elif choice == 4:
                break
            else:
                print("Invalid choice!")


def employee_services():
    while True:
    
            print("\n-----WELCOME TO THE EMPLOYEE SERVICES-----\n")
            print("1. Add New Employee")
            print("2. View All Employees")
            print("3. Search Employees by Name")
            print("4. Search Employees by Login ID")
            print("5. Search Employees by Type")
            print("6. Activate or Deactivate Employee")
            print("7. Change Employee Password")
            print("8. Go Back\n")



           choice = int(input("Enter your choice: "))


           if choice == 1:
                print("/n---ENTER THE DETAILS---\n")
                emp_login_id = input("Enter the employee login ID: ")
                emp_password = input("Enter the employee password: ")
                emp_type = input("Enter the employee type (ADMIN or EXPERT): ")
                emp_name = input("Enter the employee name: ")
                emp_phone = input("Enter the employee phone number: ")
                emp_email = input("Enter the employee email: ")

                query = "INSERT INTO employee (empLoginId, empPassword, empType, empName, empPhone, empEmail) " \
                        "VALUES (%s, %s, %s, %s, %s, %s)"
                values = (emp_login_id, emp_password, emp_type, emp_name, emp_phone, emp_email)
                cursor.execute(query, values)
                db.commit()

                print("EMPLOYEE HAS BEEN ADDED SUCCESSFULLY")


          elif choice == 2:
                query = "SELECT * FROM employee"
                cursor.execute(query)
                results = cursor.fetchall()

                if results:
                    table = tabulate(results, headers=["empLoginId", "Password", "Type", "Name", "Phone", "Email","Status"],
                                     tablefmt="pretty")
                    print(table)

                else:
                    print("\nNO EMPLOYEE FOUND ")

            elif choice == 3:
                name = input("Enter the employee name: ")
                query = "SELECT * FROM employee WHERE empName LIKE %s"
                cursor.execute(query, ('%' + name + '%',))
                results = cursor.fetchall()

                if results:
                    table = tabulate(results, headers=["empLoginId", "empPassword", "Type", "empName", "Phone", "Email",
                                     "Status"],   tablefmt="pretty" )
                    print(table)

                else:
                    print("\nNO EMPLOYEE FOUND WITH THE NAME:", name )


           elif choice == 4:
                login_id = input("Enter the employee login ID: ")
                query = "SELECT * FROM employee WHERE empLoginId = %s"
                cursor.execute(query, (login_id,))
                result = cursor.fetchall()

                if result:
                    table = tabulate(result, headers=["empLoginId", "empPassword", "Type", "empName", "Phone", "Email",
                                                      "Status"],   tablefmt="pretty")
                    print(table)
                else:
                    print("\nNO EMPLOYEE FOUND WITH LoginId:", login_id )


            elif choice == 5:
                emp_type = input("Enter the employee type (Admin or Expert): ")
                query = "SELECT * FROM employee WHERE empType = %s"
                cursor.execute(query, (emp_type,))
                results = cursor.fetchall()

                if results:
                    table = tabulate(results, headers=["empLoginId", "empPassword", "Type", "empName", "Phone", "Email",
                                                       "Status"],   tablefmt="pretty")
                    print(table)
                else:
                    print("\nNO EMPLOYEES FOUND UNDER THE TYPE:", emp_type )


            elif choice == 6:
                login_id = input("Enter the employee login ID: ")
                status = input("Enter the new status (ACTIVE or INACTIVE): ")
                query = "UPDATE employee SET empStatus = %s WHERE empLoginId = %s"
                cursor.execute(query, (status, login_id))
                db.commit()

                print("\nEMPLOYEE STATUS SUCCESSFULLY UPDATED FOR LoginId:", login_id)


            elif choice == 7:
                login_id = input("Enter the employee login ID: ")
                new_password = input("Enter the new password: ")
                query = "UPDATE employee SET empPassword = %s WHERE empLoginId = %s"
                cursor.execute(query, (new_password, login_id))
                db.commit()
                print("EMPLOYEE PASSWORD CHANGED SUCCESSFULLY FOR LoginId:",login_id )
            elif choice == 8:
                break
            else:
                print("Invalid choice!")



# Function to manage bug services in the admin module
def bug_services():
    while True:
        try:
            print("\nWELCOME TO THE BUG SERVICES\n")
            print("1. View All Bugs")
            print("2. Search Bugs by ID")
            print("3. Search Bugs by Status")
            print("4. Search Bugs by Customer Login ID")
            print("5. Assign Bug to Expert")
            print("6. Go Back\n")

            choice = int(input("Enter your choice: "))

            if choice == 1:
                query = "SELECT * FROM bug"
                cursor.execute(query)
                results = cursor.fetchall()

                if results:
                    table = tabulate(results, headers=[ "BugId","BugEntered Date", "CustomerId", "BugStatus", 
                                                        "DeviceType","BugDesc", "BugAssignedDate","ExpertId",
                                                        "BugSolvedDate","BugSoln","Feedback"],
                                     tablefmt="pretty")
                    print(table)
                else:
                    print("NO BUGS FOUND")
          


        
        


               
            
             

                





      






















# Close the database connection
db.close()
